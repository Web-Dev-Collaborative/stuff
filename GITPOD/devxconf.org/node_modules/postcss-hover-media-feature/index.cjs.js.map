{"version":3,"file":"index.cjs.js","sources":["index.js"],"sourcesContent":["module.exports = ({\n  fallback = false,\n  fallbackSelector = 'html:not(.supports-touch)',\n  rootSelectors = []\n} = {}) => {\n  function createMediaQuery (rule, { AtRule }) {\n    let media = new AtRule({ name: 'media', params: '(hover: hover)' })\n\n    media.source = rule.source\n\n    media.append(rule)\n\n    return media\n  }\n\n  function parseSelector (selector) {\n    let selectorList = selector.split(',').map(s => s.trim())\n\n    return [\n      selectorList.filter(s => s.includes(':hover')),\n      selectorList.filter(s => !s.includes(':hover'))\n    ]\n  }\n\n  function isAlreadyNested (rule) {\n    let container = rule.parent\n\n    while (container !== null && container.type !== 'root') {\n      if (\n        container.type === 'atrule' &&\n        container.params.includes('hover: hover')\n      ) {\n        return true\n      }\n\n      container = container.parent\n    }\n\n    return false\n  }\n\n  return {\n    postcssPlugin: 'postcss-hover-media-feature',\n\n    Rule (rule, { AtRule }) {\n      if (\n        !rule.selector.includes(':hover') ||\n        isAlreadyNested(rule) ||\n        rule.selector.includes(fallbackSelector)\n      ) {\n        return\n      }\n\n      let [hoverSelectorList, nonHoverSelectorList] = parseSelector(\n        rule.selector\n      )\n      let mediaQuery = createMediaQuery(\n        rule.clone({ selectors: hoverSelectorList }),\n        { AtRule }\n      )\n\n      rule.after(mediaQuery)\n\n      if (fallback) {\n        rule.before(\n          rule.clone({\n            selectors: hoverSelectorList.map(hoverSelector => {\n              if (\n                rootSelectors.some(rootSelector =>\n                  hoverSelector.startsWith(rootSelector)\n                )\n              ) {\n                return `${fallbackSelector}${hoverSelector}`\n              }\n              return `${fallbackSelector} ${hoverSelector}`\n            })\n          })\n        )\n      }\n\n      if (nonHoverSelectorList.length) {\n        rule.replaceWith(rule.clone({ selectors: nonHoverSelectorList }))\n\n        return\n      }\n\n      rule.remove()\n    }\n  }\n}\n\nmodule.exports.postcss = true\n"],"names":["module","exports","fallback","fallbackSelector","rootSelectors","createMediaQuery","rule","AtRule","media","name","params","source","append","parseSelector","selector","selectorList","split","map","s","trim","filter","includes","isAlreadyNested","container","parent","type","postcssPlugin","Rule","hoverSelectorList","nonHoverSelectorList","mediaQuery","clone","selectors","after","before","hoverSelector","some","rootSelector","startsWith","length","replaceWith","remove","postcss"],"mappings":"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"}